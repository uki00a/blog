<!doctype html><html data-reactroot=""><head><meta charSet="utf-8"/><title>週刊DenoのサイトをPagicに移行した話 | uki00a.github.io</title><meta name="description" content="uki00a.github.io"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta property="og:title" content="週刊DenoのサイトをPagicに移行した話 | uki00a.github.io"/><meta property="og:description" content="uki00a.github.io"/><meta property="og:type" content="article"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@uki00a"/><script async="" src="https://www.google-analytics.com/analytics.js"></script><script>
            window.GoogleAnalyticsObject="ga";(window.ga=window.ga||function(){(window.ga.q=window.ga.q||[]).push(arguments);}),(window.ga.l=1*new Date());

            ga('create', 'G-R8RKYMTR71', 'auto');
            ga('send', 'pageview');</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.min.css"/><link rel="icon" href="https://raw.githubusercontent.com/uki00a/blog/master/src/assets/favicon.ico"/><meta property="og:image" content="https://raw.githubusercontent.com/uki00a/blog/master/src/assets/avatar.png"/></head><body><header><div><a href="https://uki00a.github.io/blog/index.html">uki00a.github.io</a></div></header><main><article><h1>週刊DenoのサイトをPagicに移行した話</h1>
<h2 id="%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB">はじめに<a class="anchor" href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB">§</a></h2>
<p>個人で<a href="https://uki00a.github.io/deno-weekly/">週刊Deno</a>というサイトを運営しています。</p>
<p>このサイトで使用しているスタティックサイトジェネレータを<a href="https://github.com/xcatliu/pagic">Pagic</a>に移行したため、その中で得たノウハウなどについてまとめてみます。</p>
<h2 id="pagic%E3%81%A8%E3%81%AF">Pagicとは?<a class="anchor" href="#pagic%E3%81%A8%E3%81%AF">§</a></h2>
<p>PagicはDenoとReactをベースにしたスタティックサイトジェネレータです。</p>
<p>以下のような特徴を備えています。</p>
<ul>
<li>記事をtsxまたはMarkdownで記述できます。</li>
<li>カスタムテーマやプラグインシステムによって拡張することが可能です。</li>
<li>目次の自動生成をサポートしています。</li>
<li>ページのタグ付けをサポートしています(blogプラグイン)</li>
</ul>
<h2 id="%E7%A7%BB%E8%A1%8C%E7%90%86%E7%94%B1">移行理由<a class="anchor" href="#%E7%A7%BB%E8%A1%8C%E7%90%86%E7%94%B1">§</a></h2>
<p>当初は、Markdownで記事を書いてそこからHTMLを生成できれば十分であったため、自作のDenoスクリプトを作成して運用していました。</p>
<p>しかし、運用とともに様々な機能を追加していった結果、このスクリプトは徐々に肥大化していきました。</p>
<p>また、将来的に追加していきたい機能も複数存在している状況でした。</p>
<p>このままこのスクリプトに機能を追加していくより、やりたい機能を一通り提供しており、十分にテストもされているPagicに移行した方が楽そうと判断し、移行することにしました。</p>
<h2 id="pagic%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">Pagicの使い方について<a class="anchor" href="#pagic%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">§</a></h2>
<h3 id="%E3%81%8A%E3%81%8A%E3%81%BE%E3%81%8B%E3%81%AA%E4%BD%BF%E3%81%84%E6%96%B9">おおまかな使い方<a class="anchor" href="#%E3%81%8A%E3%81%8A%E3%81%BE%E3%81%8B%E3%81%AA%E4%BD%BF%E3%81%84%E6%96%B9">§</a></h3>
<ol>
<li><code>pagic.config.ts</code>または<code>pagic.config.tsx</code>をルートディレクトリに用意する。</li>
<li><code>$ pagic build —watch —serve</code>でdevサーバを起動する。</li>
<li>エディタで記事を書く。</li>
<li>http://localhost:8000で生成されたページを確認する。</li>
</ol>
<h3 id="%E8%A8%AD%E5%AE%9A%E4%BE%8B">設定例<a class="anchor" href="#%E8%A8%AD%E5%AE%9A%E4%BE%8B">§</a></h3>
<p>設定ファイルは<code>pagic.config.ts</code>または<code>pagic.config.tsx</code>と命名します。</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">React</span> <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">"pagic"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  root<span class="token operator">:</span> <span class="token string">"<a class="token url-link" href="https://uki00a.github.io/deno-weekly/">https://uki00a.github.io/deno-weekly/</a>"</span><span class="token punctuation">,</span>
  title<span class="token operator">:</span> <span class="token string">"週刊Deno"</span><span class="token punctuation">,</span>
  description<span class="token operator">:</span> <span class="token string">"このサイトでは、毎週Denoに関わる最新情報を発信しています。"</span><span class="token punctuation">,</span>
  srcDir<span class="token operator">:</span> <span class="token string">"."</span><span class="token punctuation">,</span>
  theme<span class="token operator">:</span> <span class="token string">"blog"</span><span class="token punctuation">,</span> <span class="token comment">// Pagicには"default", "blog", "docs"の3種類のテーマが組み込まれています。</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"blog"</span><span class="token punctuation">,</span> <span class="token string">"ga"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// &lt;head>タグの内容</span>
  head<span class="token operator">:</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span>
        <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>icon<span class="token punctuation">"</span></span>
        <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><a class="token url-link" href="https://raw.githubusercontent.com/uki00a/blog/master/src/assets/favicon.ico">https://raw.githubusercontent.com/uki00a/blog/master/src/assets/favicon.ico</a><span class="token punctuation">"</span></span>
      <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span>
        <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>og:image<span class="token punctuation">"</span></span>
        <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><a class="token url-link" href="https://raw.githubusercontent.com/uki00a/blog/master/src/assets/avatar.png">https://raw.githubusercontent.com/uki00a/blog/master/src/assets/avatar.png</a><span class="token punctuation">"</span></span>
      <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>twitter:card<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>summary<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>twitter:site<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@uki00a<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>twitter:creator<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@uki00a<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
  blog<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ブログ記事が格納されているディレクトリを指定</span>
    root<span class="token operator">:</span> <span class="token string">"/articles"</span><span class="token punctuation">,</span>
    <span class="token comment">// SNSなどの情報 (ハンバーガーメニュー内にリンクが表示されます🍔)</span>
    social<span class="token operator">:</span> <span class="token punctuation">{</span>
      github<span class="token operator">:</span> <span class="token string">"uki00a"</span><span class="token punctuation">,</span>
      email<span class="token operator">:</span> <span class="token string">"<a class="token email-link" href="mailto:uki00a@gmail.com">uki00a@gmail.com</a>"</span><span class="token punctuation">,</span>
      twitter<span class="token operator">:</span> <span class="token string">"uki00a"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  ga<span class="token operator">:</span> <span class="token keyword">typeof</span> <span class="token maybe-class-name">Deno</span> <span class="token operator">===</span> <span class="token string">"undefined"</span> <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token maybe-class-name">Deno</span><span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"TRACKING_ID"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  tools<span class="token operator">:</span> <span class="token punctuation">{</span>
    editOnGitHub<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    backToTop<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  md<span class="token operator">:</span> <span class="token punctuation">{</span>
    tocEnabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// ハンバーガーメニューの設定🍔</span>
  nav<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      text<span class="token operator">:</span> <span class="token string">"ホーム"</span><span class="token punctuation">,</span>
      link<span class="token operator">:</span> <span class="token string">"<a class="token url-link" href="https://uki00a.github.io/deno-weekly">https://uki00a.github.io/deno-weekly</a>"</span><span class="token punctuation">,</span>
      icon<span class="token operator">:</span> <span class="token string">"czs-home-l"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      text<span class="token operator">:</span> <span class="token string">"タグ一覧"</span><span class="token punctuation">,</span>
      link<span class="token operator">:</span> <span class="token string">"<a class="token url-link" href="https://uki00a.github.io/deno-weekly/tags">https://uki00a.github.io/deno-weekly/tags</a>"</span><span class="token punctuation">,</span>
      icon<span class="token operator">:</span> <span class="token string">"czs-tag-l"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      text<span class="token operator">:</span> <span class="token string">"カテゴリ一覧"</span><span class="token punctuation">,</span>
      link<span class="token operator">:</span> <span class="token string">"<a class="token url-link" href="https://uki00a.github.io/deno-weekly/categories">https://uki00a.github.io/deno-weekly/categories</a>"</span><span class="token punctuation">,</span>
      icon<span class="token operator">:</span> <span class="token string">"czs-category-l"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      text<span class="token operator">:</span> <span class="token string">"アーカイブ"</span><span class="token punctuation">,</span>
      link<span class="token operator">:</span> <span class="token string">"<a class="token url-link" href="https://uki00a.github.io/deno-weekly/archives">https://uki00a.github.io/deno-weekly/archives</a>"</span><span class="token punctuation">,</span>
      icon<span class="token operator">:</span> <span class="token string">"czs-box-l"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      text<span class="token operator">:</span> <span class="token string">"このサイトについて"</span><span class="token punctuation">,</span>
      link<span class="token operator">:</span> <span class="token string">"<a class="token url-link" href="https://uki00a.github.io/deno-weekly/about/index.html">https://uki00a.github.io/deno-weekly/about/index.html</a>"</span><span class="token punctuation">,</span>
      icon<span class="token operator">:</span> <span class="token string">"czs-about-l"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>依存関係は<a href="https://github.com/WICG/import-maps">Import maps</a>をで管理しており、以下のように設定しています。</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"imports"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"pagic"</span><span class="token operator">:</span> <span class="token string">"<a class="token url-link" href="https://deno.land/x/pagic@v1.3.1/mod.ts">https://deno.land/x/pagic@v1.3.1/mod.ts</a>"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="%E3%83%93%E3%83%AB%E3%83%89">ビルド<a class="anchor" href="#%E3%83%93%E3%83%AB%E3%83%89">§</a></h3>
<p>Pagicで静的サイトをビルドするときは、基本的にはコマンドラインから以下のように実行します。</p>
<pre class="language-shell"><code class="language-shell">$ deno run --unstable --allow-read --allow-write --allow-net --allow-run --allow-env <a class="token url-link" href="https://deno.land/x/pagic@v1.3.1/mod.ts">https://deno.land/x/pagic@v1.3.1/mod.ts</a> build
</code></pre>
<p>しかし、このように運用をしてしまうと、Import mapsで管理しているPagicのバージョンとビルド時に使用するPagicのバージョンがずれてしまう可能性が考えられます。</p>
<p>この問題を回避するため、<code>build.ts</code>というファイルを用意しています。</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> Pagic <span class="token keyword">from</span> <span class="token string">"pagic"</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Pagic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>このようにすることで、<strong>Import mapsで管理しているバージョンのPagicを使用して静的ページをビルドすることができます。</strong></p>
<pre class="language-shell"><code class="language-shell">$ deno run --unstable --allow-read --allow-write --allow-net --allow-run --allow-env --import-map ./import_map.json ./build.ts
</code></pre>
<h2 id="%E3%83%9B%E3%82%B9%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0">ホスティング<a class="anchor" href="#%E3%83%9B%E3%82%B9%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0">§</a></h2>
<p>ホスティングサイトとしては、GitHub Pagesを使用しています。</p>
<p>デプロイはGitHub Actionsで自動化しています。</p>
<p>Pagicでビルドした静的ファイルはデフォルトでdistディレクトリに生成されるため、それらのファイルを<a href="https://github.com/peaceiris/actions-gh-pages">https://github.com/peaceiris/actions-gh-pages</a>を使って、GitHub Pagesへデプロイしています。</p>
<p>GitHub Actionsのワークフローの定義は以下の通りです。</p>
<pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> ci
<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">push</span><span class="token punctuation">:</span>
    <span class="token key atrule">branches</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> main
  <span class="token key atrule">pull_request</span><span class="token punctuation">:</span>
    <span class="token key atrule">branches</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"**"</span>

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">build</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> <a class="token email-link" href="mailto:actions/checkout@master">actions/checkout@master</a>
    <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> denolib/setup<span class="token punctuation">-</span><a class="token email-link" href="mailto:deno@master">deno@master</a>
      <span class="token key atrule">with</span><span class="token punctuation">:</span>
        <span class="token key atrule">deno-version</span><span class="token punctuation">:</span> 1.10.2
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Run fmt
      <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
        deno fmt --check --ignore=articles</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Run lint
      <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
        deno lint --unstable --ignore=articles</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Build
      <span class="token key atrule">env</span><span class="token punctuation">:</span>
        <span class="token key atrule">URL</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//uki00a.github.io/deno<span class="token punctuation">-</span>weekly
        <span class="token key atrule">TRACKING_ID</span><span class="token punctuation">:</span> G<span class="token punctuation">-</span>MK2K2MRMBF
      <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
        deno run --unstable --allow-read --allow-write --allow-net --allow-run --allow-env --import-map ./import_map.json ./build.ts</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy
      <span class="token key atrule">uses</span><span class="token punctuation">:</span> peaceiris/actions<span class="token punctuation">-</span>gh<span class="token punctuation">-</span>pages@v3
      <span class="token key atrule">if</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> github.event_name == 'push' <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token key atrule">with</span><span class="token punctuation">:</span>
        <span class="token key atrule">github_token</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.GITHUB_TOKEN <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token key atrule">publish_dir</span><span class="token punctuation">:</span> ./dist
</code></pre>
<p>このようなファイルを<code>.github/workflows</code>ディレクトリに用意することで、リポジトリにpushするたびにGitHub Pagesへ静的ファイルがデプロイされます。</p>
<h2 id="%E7%A7%BB%E8%A1%8C%E3%81%97%E3%81%A6%E3%82%88%E3%81%8B%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8">移行してよかったこと<a class="anchor" href="#%E7%A7%BB%E8%A1%8C%E3%81%97%E3%81%A6%E3%82%88%E3%81%8B%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8">§</a></h2>
<p>Pagicはページのタグ付け(blogプラグイン)や目次の生成機能などが提供されているのが便利に感じました。</p>
<p>また、ダイナミックなページを生成したいときに、tsxで書けるのもよいところだと思います。</p>
<p>デフォルトでblog, docs, defaultなどのテーマが提供されており、OSSのドキュメントサイトなどを手軽に作成したい場合などにも便利なのではないかと思います。</p>
<h2 id="%E9%80%86%E3%81%AB%E7%A7%BB%E8%A1%8C%E3%81%97%E3%81%A6%E8%BE%9B%E3%81%8F%E6%84%9F%E3%81%98%E3%81%A6%E3%81%84%E3%82%8B%E3%81%93%E3%81%A8">逆に移行して辛く感じていること<a class="anchor" href="#%E9%80%86%E3%81%AB%E7%A7%BB%E8%A1%8C%E3%81%97%E3%81%A6%E8%BE%9B%E3%81%8F%E6%84%9F%E3%81%98%E3%81%A6%E3%81%84%E3%82%8B%E3%81%93%E3%81%A8">§</a></h2>
<p>移行した影響により、ビルド時間が若干増加しました。(高速化するテクニックについては後述します)</p>
<p>このあたりはトレードオフなので仕方ないと考えています。</p>
<h2 id="%E3%81%AF%E3%81%BE%E3%81%A3%E3%81%9F%E7%82%B9%E3%83%BB%E3%83%8E%E3%82%A6%E3%83%8F%E3%82%A6%E3%81%AA%E3%81%A9">はまった点・ノウハウなど<a class="anchor" href="#%E3%81%AF%E3%81%BE%E3%81%A3%E3%81%9F%E7%82%B9%E3%83%BB%E3%83%8E%E3%82%A6%E3%83%8F%E3%82%A6%E3%81%AA%E3%81%A9">§</a></h2>
<h3 id="github-pages%E3%81%AB%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%81%99%E3%82%8B%E9%9A%9B%E3%81%AFconfigroot%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B%E5%BF%85%E8%A6%81%E3%81%8C%E3%81%82%E3%82%8B">GitHub Pagesにデプロイする際は<code>config.root</code>を設定する必要がある<a class="anchor" href="#github-pages%E3%81%AB%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%81%99%E3%82%8B%E9%9A%9B%E3%81%AFconfigroot%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B%E5%BF%85%E8%A6%81%E3%81%8C%E3%81%82%E3%82%8B">§</a></h3>
<p>週刊Denoのサイトは<a href="https://uki00a.github.io">https://uki00a.github.io</a>の<code>/deno-weekly</code>配下でページを公開しています。</p>
<p>このような構成の場合、デフォルトだとアセットが<code>https://uki00a.github.io/</code>から読み込まれてしまい、404エラーが発生してしまいます。</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  root<span class="token operator">:</span> <span class="token string">"<a class="token url-link" href="https://uki00a.github.io/deno-weekly/">https://uki00a.github.io/deno-weekly/</a>"</span><span class="token punctuation">,</span>
    <span class="token spread operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>このような場合、上記のように<code>pagic.config.tsx</code>の<code>root</code>プロパティでベースURLを指定することで問題を回避できます。</p>
<h3 id="%E7%9B%AE%E6%AC%A1%E3%81%AE%E7%94%9F%E6%88%90">目次の生成<a class="anchor" href="#%E7%9B%AE%E6%AC%A1%E3%81%AE%E7%94%9F%E6%88%90">§</a></h3>
<p>公式の<code>blog</code>テーマなどを使っている場合、マークダウンファイル内に<code>${toc}</code>を記述しておくと、Pagicが目次を自動生成してくれて便利です。</p>
<pre class="language-markdown"><code class="language-markdown"><span class="token hr punctuation">---</span>
title: 2021/05/24〜2021/05/30の最新情報
tags:
  <span class="token list punctuation">-</span> Sinco
  <span class="token list punctuation">-</span> Deno Deploy
  <span class="token list punctuation">-</span> Velociraptor
  <span class="token list punctuation">-</span> Cliffy
categories:
  <span class="token title important">- news
<span class="token punctuation">---</span></span>

${toc}


<span class="token title important"><span class="token punctuation">##</span> [Sinco v2.0.0のリリース](https://github.com/drashland/sinco/releases/tag/v2.0.0)</span>

...
</code></pre>
<h2 id="%E3%83%93%E3%83%AB%E3%83%89%E3%83%AA%E3%83%93%E3%83%AB%E3%83%89%E3%81%AE%E9%AB%98%E9%80%9F%E5%8C%96">ビルド/リビルドの高速化<a class="anchor" href="#%E3%83%93%E3%83%AB%E3%83%89%E3%83%AA%E3%83%93%E3%83%AB%E3%83%89%E3%81%AE%E9%AB%98%E9%80%9F%E5%8C%96">§</a></h2>
<p>ローカルでページを編集した際に、編集内容をプレビューしたい場合があります。</p>
<p>しかし、ファイル数が多くなるとビルドにそれなりに時間がかかります。</p>
<p>そのような場合、一時的にプラグインの読み込みやビルド対象のファイルを限定することで、ある程度の高速化が期待できます。</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"-clean"</span><span class="token punctuation">,</span> <span class="token string">"blog"</span><span class="token punctuation">,</span> <span class="token string">"ga"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  include<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"articles/2021/05"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token spread operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>このように<code>pagic.config.tsx</code>の設定を変更することで、以下のような効果を見込めます。</p>
<ul>
<li><code>plugins</code>に<code>-clean</code>を指定して<code>clear</code>プラグインを無効化することで、静的ファイルの生成が若干高速化されます。</li>
<li><code>include</code>に<code>articles/2021/05</code>を指定することで、そのディレクトリ配下のファイルのみがビルドされるようになります。</li>
</ul>
<h3 id="404%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">404ページについて<a class="anchor" href="#404%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">§</a></h3>
<p>GitHub Pagesで404ページをカスタマイズしたいときは、<a href="http://docs.github.com/ja/pages/getting-started-with-github-pages/creating-a-custom-404-page-for-your-github-pages-site">404.html</a>というファイルを用意する必要があります。</p>
<p>週刊Denoのサイトでは、<code>404.html</code>を動的に生成するために、プロジェクトルートに<code>404.tsx</code>を配置しています。</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">React</span> <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">"pagic"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">PagicLayout</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"pagic"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token maybe-class-name">NotFoundPage</span><span class="token operator">:</span> <span class="token function-variable function">PagicLayout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> config <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">ページが見つかりませんでした</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>config<span class="token punctuation">.</span>root<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">index.html</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">TOPページ</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>config<span class="token punctuation">.</span>root<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">tags/index.html</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">タグ一覧</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>config<span class="token punctuation">.</span>root<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">archives/index.html</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">アーカイブ</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token maybe-class-name">NotFoundPage</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="twitter%E3%82%AB%E3%83%BC%E3%83%89%E3%82%92%E7%94%9F%E6%88%90%E3%81%97%E3%81%9F%E3%81%84">Twitterカードを生成したい<a class="anchor" href="#twitter%E3%82%AB%E3%83%BC%E3%83%89%E3%82%92%E7%94%9F%E6%88%90%E3%81%97%E3%81%9F%E3%81%84">§</a></h3>
<p>Pagicの組み込みテーマ(<code>default</code> or <code>blob</code> or <code>docs</code>)を使っている場合、<code>pagic.config.tsx</code>の<code>blog.social.twitter</code>を設定しておくと、Twitterカード用のmetaタグが生成されます。</p>
<pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">export</span> default <span class="token punctuation">{</span>
  <span class="token punctuation">..</span>.
  blog: <span class="token punctuation">{</span>
    root: <span class="token string">"/articles"</span>,
    social: <span class="token punctuation">{</span>
      github: <span class="token string">"uki00a"</span>,
      email: <span class="token string">"<a class="token email-link" href="mailto:uki00a@gmail.com">uki00a@gmail.com</a>"</span>,
      twitter: <span class="token string">"uki00a"</span>,
    <span class="token punctuation">}</span>,
  <span class="token punctuation">}</span>,
  <span class="token punctuation">..</span>.
<span class="token punctuation">}</span>
</code></pre>
<h2 id="%E5%8F%82%E8%80%83%E6%83%85%E5%A0%B1">参考情報<a class="anchor" href="#%E5%8F%82%E8%80%83%E6%83%85%E5%A0%B1">§</a></h2>
<p><a href="https://github.com/xcatliu/pagic">https://github.com/xcatliu/pagic</a></p></article></main></body></html>